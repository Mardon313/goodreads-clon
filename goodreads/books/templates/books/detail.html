{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Book Detail Page{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="row mb-4">
    <div class="col-2">
        <img class="cover-pic" alt="cover image" src="{{ book.cover_picture.url }}" width="100%">
    </div>
    <div class="col-6 ms-5">
        <h3>{{ book.title }}</h3>
        <p>{{ book.description }}</p>
    </div>
</div>

<hr>

<div class="row mt-4">

    <div class="col-md-5">
        <h5>Add a Review</h5>
        <form method="post" action="{% url 'books:review' book.id %}" id="review-form">
            {% csrf_token %}

            <label>Stars given*</label>
            <div class="star-rating">
                <input type="radio" class="star-input" name="rate" value="5" id="star5"><label for="star5" class="fas fa-star"></label>
                <input type="radio" class="star-input" name="rate" value="4" id="star4"><label for="star4" class="fas fa-star"></label>
                <input type="radio" class="star-input" name="rate" value="3" id="star3"><label for="star3" class="fas fa-star"></label>
                <input type="radio" class="star-input" name="rate" value="2" id="star2"><label for="star2" class="fas fa-star"></label>
                <input type="radio" class="star-input" name="rate" value="1" id="star1"><label for="star1" class="fas fa-star"></label>
            </div>

            {{ review_form | crispy }}

            <button type="submit" class="btn btn-success mt-2 w-100">Add review</button>
        </form>
    </div>

    <div class="col-md-7 ps-5" style="border-left: 1px solid #eee;">
        {% if book.bookreview_set.exists %}
            <h4>Reviews</h4>
            <hr>
            {% for review in book.bookreview_set.all %}
                <div class="row mb-4">
                    <div class="col-2">
                        <img class="small-profile-pic rounded-circle" src="{{ review.user.profile_picture.url }}" width="50" height="50" style="object-fit: cover;">
                    </div>
                    <div class="col-10">
                        <b>{{ review.user.username }}</b>
                        <span class="text-warning ms-2">â˜… {{ review.stars_given }}</span>
                        <br>
                        <small class="text-muted">{{ review.created_at|date:"M d, Y" }}</small>
                        <p class="mt-2 font-monospace small text-secondary">{{ review.comment }}</p>
                    </div>
                </div>
            {% endfor %} {% else %}
            <p class="text-muted">No reviews yet.</p>
        {% endif %} </div>

</div>

<style>

</style>

<script>
    const starInputs = document.querySelectorAll('.star-input');
    const djangoHiddenInput = document.getElementById('id_stars_given');

    starInputs.forEach(input => {
        input.addEventListener('change', () => {
            if(djangoHiddenInput) {
                djangoHiddenInput.value = input.value;
            }
        });
    });
</script>

{% endblock %}